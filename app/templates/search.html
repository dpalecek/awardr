{% extends "base.html" %}

{% block head_extended %}
		<link rel="stylesheet" type="text/css" href="/static2/css/search.css" />

		<script>
			{% if user_location %}
			var user_coord = {'lat': {{ user_location.lat }}, 'lng': {{ user_location.lon }}};
			{% else %}
			var user_coord = null;
			{% endif %}
			
			{% if nearest_hotels_json %}
			var nearest_hotels = {{ nearest_hotels_json }};
			{% else %}
			var nearest_hotels = [];
			{% endif %}
		</script>
		<script src="http://www.google.com/jsapi?key=ABQIAAAAbS93tJ_uidHDZWvF7euCFBRZY0UO5Ce9jhJtaWkDUN0I_qaxZRSYddpKWN0rTK8azJFokggtQdZ7FQ"></script>
		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script src="/static2/js/search.js"></script>
{% endblock %}

{% block body_content %}
			<div id="search_form_container">
				<div class="grid_16">
					<form id="search_form" action="/search" method="get">
						Hotels near
						<input type="text" name="where" id="field_where"
						 	value="{{ where }}" />,
						
						arriving
						<select type="select" name="month" id="field_month" class="field">
							{% for month in months %}
							<option value="{{ forloop.counter }}"
								{% ifequal forloop.counter user_month %}selected="selected"{% endifequal %}
							>{{ month }}</option>
							{% endfor %}
						</select>
						
						<select type="select" name="day" id="field_day" class="field">
							{% for day in days %}
							<option value="{{ day }}"
								{% ifequal day user_day %}selected="selected"{% endifequal %}
							>{{ day }}</option>
							{% endfor %}
						</select>
						
						<select type="select" name="year" id="field_year" class="field">
							{% for year in years %}
							<option value="{{ year }}"
								{% ifequal forloop.counter user_year %}
								selected="selected"
								{% endifequal %}
							>{{ year }}</option>
							{% endfor %}
						</select>
						
						for
						<select name="nights" id="field_nights" class="field">
						{% for night in nights_range %}
							<option value="{{ night }}"
								{% ifequal night user_nights %}selected="selected"{% endifequal %}
							>{{ night }}</option>
						{% endfor %}
						</select>
						nights.
						
						<input type="submit" value="Search" id="field_submit" />
					</form>
				</div>
				<div class="clear"></div>
			</div>
			
			<div id="search_results_container">
				<div class="grid_8">
					<div id="nearest_hotels_container">
					
						<h2>Hotels with award availability</h2>
						{% if hotels_tuple.0 %}
							<ol class="hotels_list" id="available_hotels_list">
							{% for hotel_data in hotels_tuple.0 %}
								<li class="hotel {% cycle odd,even %} {% if forloop.first %}first{%endif%}">
									<img src="{{ hotel_data.0.image_url }}"
										class="hotel_image tiny"
									 	alt="{{ hotel_data.0.name }}" />
								
									<div class="hotel_info">
										<span class="hotel_name">{{ hotel_data.0.name }}</span>
										{{ hotel_data.0.html_address }}
									</div>
									
									{% if hotel_data.1.SPGCP %}
									<h3>Cash and Points</h3>
									<ol class="availability_info">
									{% comment %}
										<li>
											<span class="date">8/22</span>
											<span class="points">4000 points</span>
											<span class="cash">$40</span>
										</li>							
									{% endcomment %}
									{% for rate_data in hotel_data.1.SPGCP %}
										<li>
											<span class="date">
												{{ rate_data.date|date:"M j (D)" }}</span>
											<span class="points">
												{{ rate_data.rate.points }} points</span>
											<span class="cash">
												{{ rate_data.rate.cash }} USD</span>
										</li>
									{% endfor %}
									</ol>
									{% endif %}
									
									{% if hotel_data.1.SPG %}
									<h3>Points</h3>
									<ol class="availability_info">
									{% for rate_data in hotel_data.1.SPG %}
										<li>
											<span class="date">
												{{ rate_data.date|date:"M j (D)" }}</span>
											<span class="points">
												{{ rate_data.rate.points }} points</span>
										</li>
									{% endfor %}
									</ol>
									{% endif %}
								
									<div class="clear"></div>
								</li>
							{% endfor %}
							</ol>
						{% else %}
							<p>No hotels found.</p>
						{% endif %}
						
						
						{% if hotels_tuple.1 %}
							<h2 id="unavailable_hotels_header">
								Other hotels in the area</h2>
							
							<ol class="hotels_list" id="unavailable_hotels_list">
							{% for hotel in hotels_tuple.1 %}
								<li class="hotel {% cycle odd,even %} {% if forloop.first %}first{%endif%}">
									<img src="{{ hotel.image_url }}" class="hotel_image tiny"
									 	alt="{{ hotel.name }}" />
								
									<div class="hotel_info">
										<span class="hotel_name">{{ hotel.name }}</span>

										{{ hotel.html_address }}
									</div>
								
									<div class="clear"></div>
								</li>
							{% endfor %}
							</ol>
						{% endif %}
					</div>
				</div>
				<div class="prefix_1 grid_7">
					<div id="hotels_map"></div>
				</div>
				<div class="clear"></div>
			</div>
{% endblock %}